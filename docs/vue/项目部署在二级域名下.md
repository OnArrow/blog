# 项目部署在二级域名下

## Preface

一级域名: **http://120.25.124.101/Index**。项目部署在根目录下

二级域名: **http://120.25.124.101/mall/Index**。项目部署在`mall`目录下。以下就是将项目部署二级域名`/mall`下的相关配置

## Config

### Vite 配置

```ts
import { defineConfig, loadEnv, ConfigEnv, UserConfig } from 'vite'

import path from 'path'

import createVitePlugins from './vite/plugins'

export default defineConfig(({ mode }: ConfigEnv): UserConfig => {
  return {
    // 对应二级域名的目录
    base: '/mall', // [!code focus]
    plugins: createVitePlugins(mode),
    resolve: {
      alias: {
        '@': path.resolve(__dirname, 'src')
      }
    },
    css: {
      preprocessorOptions: {
        scss: {
          additionalData: '@use "@/styles/variables.scss" as *;'
        }
      }
    }
  }
})
```

### 路由配置

```ts
import { createRouter, createWebHistory } from 'vue-router'

import type { RouteRecordRaw } from 'vue-router'

const { BASE_URL } = import.meta.env // [!code focus]

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    name: 'Layout',
    component: () => import('@/layout/Layout.vue'),
    children: [
      {
        path: '/',
        redirect: '/Index'
      },
      {
        path: '/Index',
        name: 'Index',
        component: () => import('@/views/index/Index.vue'),
        meta: {
          title: '首页',
          noCache: true
        }
      }
    ]
  },

  {
    path: '/:pathMatch(.*)*',
    name: 'NoMatch',
    component: () => import('@/views/noMatch/NoMatch.vue'),
    meta: {
      title: '404',
      noCache: true
    }
  }
]

const router = createRouter({
  history: createWebHistory(BASE_URL), // [!code focus]
  routes,
  scrollBehavior() {
    return { top: 0 }
  }
})

export default router
```

### Nginx 配置

```
location /mall {
  alias /var/www/html/mall;
  index index.html;
  try_files $uri $uri/ /mall/index.html;
}
```
